generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum USER_ROLE {
  CLIENT
  ADMINISTRATOR
}

enum EStatusOfRefill {
  SUCCESS
  FALSE
  DENIED
}

enum EStatusOfProductInInventory {
  INVENTORY
  ON_SERVER
}

enum ETypeOfProduct {
  GAME_ITEM
  SERVICE
  SETS_OF_PRODUCTS
  HTTP_REQUEST
  CURRENCY
  CARDS
}

enum ETypeOfURL {
  SITE_SECTION
  CUSTOM_PAGE
  EXTERNAL_LINK
  DROPDOWN_LIST
}

model User {
  id String @id @default(uuid())

  steamName     String    @db.LongText
  steamID       String    @db.LongText
  email         String    @unique
  password      String    @db.LongText
  steamAvatar   String    @db.LongText //? фронт отдельно запрашивает ее или мы храним у себя?
  mainBalance   Int
  bonusBalance  Int
  firstDateAuth DateTime
  lvl           Int
  experience    Int
  sumOfDeposits Int
  sumOfRefunds  Int
  discordLink   String?   @db.LongText //? как привязывать все это?
  VKLink        String?   @db.LongText
  TGLink        String?   @db.LongText
  createdAt     DateTime  @default(now())
  lastActivity  DateTime?

  role                       USER_ROLE            @default(CLIENT)
  HistoryOfMoney             HistoryOfMoney[]
  HistoryOfPurchase          HistoryOfPurchase[]
  HistoryOfTransfersSender   HistoryOfTransfers[] @relation("sender")
  HistoryOfTransfersReceiver HistoryOfTransfers[] @relation("receiver")
  Inventory                  Inventory[]
}

model HistoryOfMoney {
  id String @id @default(uuid())

  user      User?           @relation(fields: [userId], references: [id])
  userId    String?         @db.LongText
  method    String          @db.LongText
  amount    Int
  createdAt DateTime        @default(now()) //? нужен ли дефолт?
  status    EStatusOfRefill @default(FALSE)
}

model HistoryOfPurchase {
  id     String  @id @default(uuid())
  user   User?   @relation(fields: [userId], references: [id])
  userId String? @db.LongText

  amount           Int
  createdAt        DateTime    @default(now()) //? нужен ли дефолт?
  lostMainBalance  Int
  lostBonusBalance Int
  refund           Boolean
  Inventory        Inventory[]
  product          Product     @relation(fields: [productId], references: [id])
  productId        String      @db.LongText
}

model HistoryOfTransfers {
  id         String   @id @default(uuid())
  sender     User     @relation("sender", fields: [senderId], references: [id])
  receiver   User     @relation("receiver", fields: [receiverId], references: [id])
  senderId   String   @db.LongText
  receiverId String   @db.LongText
  amount     Int
  createdAt  DateTime @default(now()) //? нужен ли дефолт?
}

model Inventory {
  id                  String                      @id @default(uuid())
  amount              Int
  status              EStatusOfProductInInventory @default(INVENTORY)
  dateOfReceive       DateTime?
  purchase            HistoryOfPurchase           @relation(fields: [historyOfPurchaseId], references: [id])
  historyOfPurchaseId String                      @db.LongText
  user                User                        @relation(fields: [userId], references: [id])
  userId              String                      @db.LongText
  typeOfSever         TypeOfServer                @relation(fields: [typeOfServerId], references: [id])
  typeOfServerId      String                      @db.LongText
  server              Server                      @relation(fields: [serverId], references: [id])
  serverId            String                      @db.LongText
  serverName          String?                     @db.LongText //? нужно ли значение по дефолту?
  product             Product                     @relation(fields: [productId], references: [id])
  productId           String                      @db.LongText
}

model TypeOfServer {
  id          String      @id @default(uuid())
  name        String      @db.LongText
  description String      @db.LongText
  number      Int
  hidden      Boolean     @default(false)
  Inventory   Inventory[]
  Server      Server[]
  Product     Product[]
}

model Server {
  id             String       @id @default(uuid())
  typeOfSever    TypeOfServer @relation(fields: [typeOfServerId], references: [id])
  typeOfServerId String       @db.LongText
  IP             String       @db.LongText
  port           String       @db.LongText
  apiKey         String       @db.LongText
  Inventory      Inventory[]
}

model Product {
  id                String              @id @default(uuid())
  name              String              @db.LongText
  description       String              @db.LongText
  image             String              @db.LongText
  type              ETypeOfProduct
  productContent    Json
  typeOfServer      TypeOfServer        @relation(fields: [typeOfServerId], references: [id])
  typeOfServerId    String              @db.LongText
  amount            Int
  isChangeAmount    Boolean             @default(false)
  price             Int
  discount          Int?
  saleDiscount      Int?
  saleDelaySeconds  Int?
  saleDeadline      DateTime?
  maxCountOfSale    Int?
  hidden            Boolean             @default(false)
  number            Int?
  autoactivation    Boolean             @default(false)
  HistoryOfPurchase HistoryOfPurchase[]
  Inventory         Inventory[]
}

model Promocodes {
  id                String   @id @default(uuid())
  name              String   @db.LongText
  countOfActivation Int
  createdAt         DateTime @default(now())
  startDate         DateTime
  endDate           DateTime
  discountAmount    Int?
  depositBonus      Int?
  plusBonusBalance  Int?
  limitActivation   Int
  groupId           String   @default(uuid()) @db.LongText
  itemSet           String   @db.LongText
}

model baseSettings {
  id           String  @id @default(uuid())
  header       String  @db.LongText
  saleMode     Boolean @default(false)
  startBalance Int
  mainPage     String  @db.LongText
  apiKey       String  @db.LongText
  IPWhiteList  String  @db.LongText
}

model urlSettings {
  id       String     @id @default(uuid())
  icon     String     @db.LongText //? храним юрлу на фото или локально?
  typeUrl  ETypeOfURL
  url      String     @db.LongText
  hidden   Boolean    @default(false)
  name     String?    @db.LongText
  sections String?    @db.LongText
}
